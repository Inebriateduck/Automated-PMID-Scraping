#prior to first use install openpyxl 
#pip3 install openpyxl
#or
#pip istall openxyl

import re
from openpyxl import load_workbook
from openpyxl.styles import PatternFill

def replace_unicode_and_highlight(file_path, output_path):
    # Load the workbook
    wb = load_workbook("[target path]") #put your target path here

    # Regex pattern to match Unicode hex code form &#xxxx;
    unicode_pattern = re.compile(r'&#x([0-9a-fA-F]+);')

    # Define a fill style for highlighting
    highlight_fill = PatternFill(start_color="FFFF00", end_color="FFFF00", fill_type="solid")

    # Iterate through all sheets in the workbook
    for sheet in wb.worksheets:
        # Iterate through each row and column
        for row in sheet.iter_rows():
            for cell in row:
                if cell.value and isinstance(cell.value, str):
                    # Find all matches in the cell value
                    matches = unicode_pattern.findall(cell.value)
                    if matches:
                        # Replace each match with the corresponding Unicode character
                        for match in matches:
                            unicode_char = chr(int(match, 16))  # Convert hex to Unicode character
                            cell.value = unicode_pattern.sub(unicode_char, cell.value, 1)

                        # Highlight the cell
                        cell.fill = highlight_fill

    # Save the modified workbook to a new file
    wb.save("[output directory]/output.xlsx") #saves the output file as "output.xlsx" in your target directory

